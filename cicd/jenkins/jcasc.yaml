jenkins:
  systemMessage: "Jenkins configured automatically by Jenkins Configuration as Code plugin\n\n"
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: "admin"
          password: "admin"
        - id: "dev"
          password: "dev"
  authorizationStrategy:
    globalMatrix:
      permissions:
        - "Job/Build:dev"
        - "Job/Cancel:dev"
        - "Job/Read:dev"
        - "Job/Workspace:dev"
        - "Overall/Administer:admin"
        - "Overall/Read:authenticated"
        - "Run/Replay:dev"
        - "Run/Update:dev"
  # globalNodeProperties:
  # - envVars:
  #     env:
  #     - key: VARIABLE1
  #       value: foo
  #     - key: VARIABLE2
  #       value: bar
  # nodes:
  #   - permanent:
  #       name: "static-agent"
  #       remoteFS: "/home/jenkins"
  #       launcher:
  #         jnlp:
  #           workDirSettings:
  #             disabled: true
  #             failIfWorkDirIsMissing: false
  #             internalDir: "remoting"
  #             workDirPath: "/tmp"
  # slaveAgentPort: 50000
  # agentProtocols:
  #   - "jnlp2"

jobs:
  - script: |
      multibranchPipelineJob('sample-service') {
        branchSources {
          git {
            id = 'sample-service'
            remoteName = 'origin'
            remote('https://github.com/amitkshirsagar13/sample-service.git')
            includes('feature*')
            excludes('')
          }
        }
      }

      pipelineJob('jte-demo-scripted') {
        def repo = 'https://github.com/amitkshirsagar13/sample-service.git'
        description("Pipeline for jte-scripted")
        displayName("Sample-Service-jte-scripted")
        definition {
          cpsScm {
            scm {
              git {
                remote { 
                  url(repo) 
                  credentials('github-ci-user')
                }
                branches('master', '**/feature*')
                scriptPath('Jenkinsfile.jte-scripted')
                extensions { }  // required as otherwise it may try to tag the repo, which you may not want
              }
            }
          }
        }
      }

      pipelineJob('jte-demo-declarative') {
        def repo = 'https://github.com/amitkshirsagar13/sample-service.git'
        description("Pipeline for jte-declarative")
        displayName("Sample-Service-jte-declarative")
        definition {
          cpsScm {
            scm {
              git {
                remote { 
                  url(repo) 
                  credentials('github-ci-user')
                }
                branches('master', '**/feature*')
                scriptPath('Jenkinsfile.jte-declarative')
                extensions { }  // required as otherwise it may try to tag the repo, which you may not want
              }
            }
          }
        }
      }

credentials:
  system:
    domainCredentials:
      - credentials:
          #######
          # User Auth
          #######
          - usernamePassword:
              scope: "GLOBAL"
              id: "github-ci-${jenkins-basic-auth-credentials/github-ci-user}"
              description: "Github CI ${jenkins-basic-auth-credentials/github-ci-user} Credentials"
              username: "${jenkins-basic-auth-credentials/github-ci-user}"
              password: "${jenkins-basic-auth-credentials/github-ci-password}"
          ########
          # Tokens
          ########
          - string:
              scope: "GLOBAL"
              id: "github-ci-token"
              description: "Github CI Global Token"
              secret: "${github-ci-token}"
          ########
          # SSH Keys
          ########
          # - basicSSHUserPrivateKey:
          #     scope: "GLOBAL"
          #     id: "deploy-key-shared-library"
          #     username: "root"
          #     passphrase: ""
          #     description: "Deploy key for global shared library"
          #     privateKeySource:
          #       directEntry:
          #         privateKey: "${jenkins-ssh-keys/deploy-key-shared-library}"
          # - basicSSHUserPrivateKey:
          #     scope: "GLOBAL"
          #     id: "ssh-agent-access-key"
          #     username: "ubuntu"
          #     passphrase: ""
          #     description: "SSH key to access agents"
          #     privateKeySource:
          #       directEntry:
          #         privateKey: "${jenkins-ssh-keys/ssh-agent-access-key}"

tool:
  jdk:
    installations:
      # - name: "open-jdk8"
      #   properties:
      #     - installSource:
      #         installers:
      #           - adoptOpenJdkInstaller:
      #               id: "jdk8u232-b09"
      - name: "jdk8"
        properties:
          - installSource:
              installers:
                - jdkInstaller:
                    acceptLicense: true
                    id: "jdk-8u221-oth-JPR"
  maven: # (1)
    installations:
    - name: "maven"
      properties:
      - installSource:
          installers:
          - maven:
              id: "3.8.2"
  dockerTool:
    installations:
    - name: "docker"
      properties:
      - installSource:
          installers:
          - fromDocker:
              version: "latest"
  git:
    installations:
    - home: "git"
      name: "Default"
unclassified:
  globalLibraries:
    libraries:
      - name: "devops-ci-lib"
        retriever:
          modernSCM:
            scm:
              git:
                remote: "git@github.com:amitkshirsagar13/base-pipeline.git"
                credentialsId: "github-ci-user"
  templateGlobalConfig:
    tier:
      configurationProvider: "null"
      librarySources:
      - libraryProvider:
          scm:
            baseDir: "libraries"
            scm:
              git:
                branches:
                - name: "*/main"
                buildChooser: "default"
                userRemoteConfigs:
                - credentialsId: "github-ci-user"
                  url: "https://github.com/amitkshirsagar13/devops.git"